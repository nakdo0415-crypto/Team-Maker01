<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OTP FC Team Maker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Firebase SDK (Compat Version) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <!-- html2canvas for capturing -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;700;900&display=swap');
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: #f1f5f9;
            user-select: none;
        }
        .team-card { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .team-card:hover { transform: translateY(-4px); }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        button:active { transform: scale(0.96); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="loading-screen" class="fixed inset-0 bg-white flex flex-col items-center justify-center z-[9999]">
        <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 font-bold text-slate-500 italic text-sm">데이터 동기화 중...</p>
    </div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyCAcQzliuWJTB8vPm9gb0vsyR8pIAx7YTw",
            authDomain: "otp-fc-check.firebaseapp.com",
            projectId: "otp-fc-check",
            storageBucket: "otp-fc-check.firebasestorage.app",
            messagingSenderId: "907414776392",
            appId: "1:907414776392:web:0a29a660bb956e5a40467d"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const APP_ID = 'otp-fc-attendance';

        const getCol = (name) => db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection(name);

        const Icon = {
            Refresh: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M23 4v6h-6"/><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/></svg>,
            Heart: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>,
            Layout: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="3" y1="9" x2="21" y2="9"/><line x1="9" y1="21" x2="9" y2="9"/></svg>,
            Bookmark: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>,
            Trash: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>,
            Camera: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>,
            Download: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>,
            Shield: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        };

        function App() {
            const [members, setMembers] = useState([]);
            const [sessionData, setSessionData] = useState([]);
            const [savedDrafts, setSavedDrafts] = useState([]);
            const [meetingDate, setMeetingDate] = useState('');
            const [meetingTime, setMeetingTime] = useState({ start: '', end: '' }); 
            const [syncManagerName, setSyncManagerName] = useState(''); 
            const [teamingSettings, setTeamingSettings] = useState({
                teamCount: 3,
                keepCouples: true
            });
            const [teams, setTeams] = useState([]);
            const [activeTab, setActiveTab] = useState('generator');
            const [isCapturing, setIsCapturing] = useState(false);

            const teamRefs = useRef([]);

            useEffect(() => {
                const init = async () => {
                    try {
                        await auth.signInAnonymously();
                        document.getElementById('loading-screen').style.display = 'none';
                    } catch (e) { console.error(e); }
                };
                init();

                const unsubMembers = getCol('members').onSnapshot(snap => {
                    setMembers(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                });

                const unsubSession = getCol('weekly_session').onSnapshot(snap => {
                    setSessionData(snap.docs.map(d => ({ id: d.id, ...d.data() })));
                });
                
                const unsubSettings = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('settings').doc('meeting_time').onSnapshot(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        setMeetingDate(data.date || "");
                        setMeetingTime({
                            start: data.start || "",
                            end: data.end || ""
                        });
                        setSyncManagerName(data.managerName || "");
                    }
                });

                const unsubDrafts = getCol('team_drafts').onSnapshot(snap => {
                    const data = snap.docs.map(d => ({ id: d.id, ...d.data() }));
                    setSavedDrafts(data.sort((a,b) => b.createdAt.localeCompare(a.createdAt)));
                });
                return () => { unsubMembers(); unsubSession(); unsubSettings(); unsubDrafts(); };
            }, []);

            const selectedList = useMemo(() => {
                if (!meetingDate) return [];
                return sessionData.filter(s => s.date === meetingDate && s.status !== '노쇼');
            }, [sessionData, meetingDate]);

            // --- 팀 편성 알고리즘 ---
            const generateTeams = () => {
                const { teamCount, keepCouples } = teamingSettings;
                const totalAttendees = selectedList.length;

                if (totalAttendees < teamCount) {
                    alert("참여 인원이 팀 수보다 적습니다.");
                    return;
                }

                let pool = selectedList.map(p => {
                    const masterInfo = members.find(m => m.id === p.memberId) || {};
                    return {
                        ...p,
                        name: masterInfo.name || p.name,
                        level: parseInt(masterInfo.level || p.level || 99),
                        coupleId: masterInfo.coupleId || '',
                        gender: masterInfo.gender || p.gender || '남성',
                        isGuest: p.isGuest || false
                    };
                });

                let units = [];
                let processedIds = new Set();
                if (keepCouples) {
                    pool.forEach(p => {
                        if (!processedIds.has(p.id)) {
                            if (p.coupleId) {
                                const partner = pool.find(o => o.memberId === p.coupleId && !processedIds.has(o.id));
                                if (partner) {
                                    units.push({ members: [p, partner], avgLevel: (p.level + partner.level) / 2 });
                                    processedIds.add(p.id); processedIds.add(partner.id);
                                    return;
                                }
                            }
                            units.push({ members: [p], avgLevel: p.level });
                            processedIds.add(p.id);
                        }
                    });
                } else {
                    units = pool.map(p => ({ members: [p], avgLevel: p.level }));
                }

                units.sort((a, b) => (a.avgLevel - b.avgLevel) || (Math.random() - 0.5));
                
                const baseCount = Math.floor(totalAttendees / teamCount);
                const remainder = totalAttendees % teamCount;
                const targetSizes = Array(teamCount).fill(baseCount);
                for (let i = 0; i < remainder; i++) targetSizes[i]++;

                const resultTeams = Array.from({ length: teamCount }, () => []);
                let currentIdx = Math.floor(Math.random() * teamCount);
                let direction = Math.random() > 0.5 ? 1 : -1;

                units.forEach(unit => {
                    let assigned = false;
                    let attempts = 0;
                    while (!assigned && attempts < teamCount) {
                        const target = (currentIdx + teamCount) % teamCount;
                        if (resultTeams[target].length + unit.members.length <= targetSizes[target]) {
                            resultTeams[target].push(...unit.members);
                            assigned = true;
                            currentIdx = target;
                        } else {
                            currentIdx += direction;
                            attempts++;
                        }
                    }
                    if (!assigned) {
                        const minTeam = resultTeams.reduce((prev, curr) => prev.length <= curr.length ? prev : curr);
                        minTeam.push(...unit.members);
                    }
                    currentIdx += direction;
                    if (currentIdx >= teamCount) { currentIdx = teamCount - 1; direction = -1; }
                    else if (currentIdx < 0) { currentIdx = 0; direction = 1; }
                });

                const finalTeams = resultTeams.map(teamMembers => {
                    const currentTeamSize = teamMembers.length;
                    if (currentTeamSize === 0) return { members: [] };
                    const females = teamMembers.filter(m => m.gender === '여성').sort((a, b) => a.level - b.level);
                    const slot3 = (currentTeamSize >= 3 && females.length > 0) ? females.shift() : null;
                    const slot6 = (currentTeamSize >= 6 && females.length > 0) ? females.shift() : null;
                    const others = teamMembers.filter(m => m !== slot3 && m !== slot6).sort((a, b) => a.level - b.level);
                    const reordered = Array(currentTeamSize).fill(null);
                    if (slot3) reordered[2] = slot3;
                    if (slot6) reordered[5] = slot6;
                    for (let i = 0; i < currentTeamSize; i++) {
                        if (reordered[i] === null) {
                            const nextPerson = others.shift();
                            if (nextPerson) reordered[i] = nextPerson;
                        }
                    }
                    return { members: reordered.filter(m => m !== null) };
                });

                setTeams(finalTeams);
                setActiveTab('results');
            };

            const saveDraft = async () => {
                if (teams.length === 0) return;
                try {
                    const now = new Date();
                    const timeStr = now.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    await getCol('team_drafts').add({
                        meetingDate, 
                        meetingTimeRange: `${meetingTime.start} ~ ${meetingTime.end}`,
                        createdAt: now.toISOString(),
                        timeLabel: timeStr, teams,
                        managerName: syncManagerName 
                    });
                    alert("성공적으로 저장되었습니다.");
                } catch (e) { alert("저장 실패"); }
            };

            const loadDraft = (draft) => { 
                setTeams(draft.teams); 
                setSyncManagerName(draft.managerName || "");
                if (draft.meetingTimeRange) {
                    const [s, e] = draft.meetingTimeRange.split(' ~ ');
                    setMeetingTime({ start: s, end: e });
                }
                setActiveTab('results'); 
            };

            const deleteDraft = async (id) => { if (confirm("삭제하시겠습니까?")) await getCol('team_drafts').doc(id).delete(); };

            const downloadImage = (dataUrl, filename) => {
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const captureIndividualTeams = async () => {
                setIsCapturing(true);
                try {
                    for (let i = 0; i < teams.length; i++) {
                        const element = teamRefs.current[i];
                        if (element) {
                            const canvas = await html2canvas(element, { backgroundColor: '#f1f5f9', scale: 2 });
                            downloadImage(canvas.toDataURL('image/png'), `${meetingDate}_TEAM_${i + 1}.png`);
                        }
                    }
                } catch (e) { alert("캡쳐 중 오류가 발생했습니다."); }
                setIsCapturing(false);
            };

            const captureAllInOne = async () => {
                setIsCapturing(true);
                const container = document.createElement('div');
                container.style.padding = '50px';
                container.style.backgroundColor = '#f1f5f9';
                container.style.width = '1200px';
                container.style.display = 'grid';
                container.style.gridTemplateColumns = 'repeat(3, 1fr)';
                container.style.gap = '25px';
                container.style.position = 'fixed';
                container.style.top = '-9999px';

                const header = document.createElement('div');
                header.style.gridColumn = 'span 3';
                header.style.textAlign = 'center';
                header.style.marginBottom = '30px';
                header.innerHTML = `
                    <h1 style="font-size: 42px; font-weight: 900; color: #0f172a; margin-bottom: 8px; font-family: 'Pretendard', sans-serif;">OTP FC TEAM LIST</h1>
                    <div style="font-size: 18px; font-weight: 700; color: #64748b; font-family: 'Pretendard', sans-serif; display: flex; align-items: center; justify-content: center; gap: 10px;">
                        <span>DATE: ${meetingDate} (${meetingTime.start} ~ ${meetingTime.end})</span>
                        ${syncManagerName ? `<span style="color: #cbd5e1;">|</span> <span style="display: flex; align-items: center; gap: 5px;">${syncManagerName}</span>` : ''}
                    </div>
                `;
                container.appendChild(header);

                document.body.appendChild(container);

                teamRefs.current.forEach((ref) => {
                    if (ref) {
                        const clone = ref.cloneNode(true);
                        clone.style.width = '100%';
                        clone.style.transform = 'none';
                        clone.style.boxShadow = 'none';
                        clone.style.border = '1px solid #e2e8f0';
                        container.appendChild(clone);
                    }
                });

                try {
                    const canvas = await html2canvas(container, { backgroundColor: '#f1f5f9', scale: 2 });
                    downloadImage(canvas.toDataURL('image/png'), `${meetingDate}_ALL_TEAMS.png`);
                } catch (e) { alert("전체 캡쳐 중 오류가 발생했습니다."); }

                document.body.removeChild(container);
                setIsCapturing(false);
            };

            return (
                <div className="max-w-4xl mx-auto p-4 sm:p-8 pb-24 text-left">
                    <header className="mb-10 text-center text-slate-900">
                        <h1 className="text-4xl font-black italic tracking-tighter uppercase mb-3">Team Maker</h1>
                        <div className="flex flex-col items-center gap-3">
                            <div className="inline-flex flex-col items-center bg-white px-6 py-3 rounded-[24px] border border-slate-200 shadow-sm transition-all hover:shadow-md">
                                <div className="flex items-center gap-2 mb-1">
                                    <span className="text-sm font-black text-blue-600 uppercase tracking-widest">{meetingDate || 'Syncing...'}</span>
                                    {meetingTime.start && (
                                        <React.Fragment>
                                            <div className="w-px h-3 bg-slate-200" />
                                            <span className="text-sm font-black text-green-600 flex items-center gap-1">
                                                <Icon.Clock /> {meetingTime.start} ~ {meetingTime.end}
                                            </span>
                                        </React.Fragment>
                                    )}
                                </div>
                                <span className="text-xs font-bold text-slate-400">{selectedList.length}명 참여 확정</span>
                            </div>
                            
                            {syncManagerName && (
                                <div className="flex items-center gap-2 text-blue-600 font-bold text-xs uppercase tracking-wide animate-fade-in bg-blue-50 px-5 py-2 rounded-full border border-blue-100 shadow-sm">
                                    <Icon.Shield />
                                    <span className="font-black underline decoration-2 underline-offset-4 decoration-blue-200">{syncManagerName}</span>
                                </div>
                            )}
                        </div>
                    </header>

                    <nav className="flex gap-2 mb-8 bg-slate-200/50 p-1.5 rounded-2xl">
                        {['generator', 'results', 'drafts'].map(t => (
                            <button key={t} onClick={() => setActiveTab(t)} className={`flex-1 py-3 rounded-xl font-black text-xs sm:text-sm transition-all ${activeTab === t ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>
                                {t === 'generator' ? '설정 및 생성' : t === 'results' ? '현재 편성' : '저장소'}
                            </button>
                        ))}
                    </nav>

                    {activeTab === 'generator' && (
                        <div className="space-y-6 animate-fade-in text-left">
                            <div className="bg-white p-6 rounded-[32px] border border-slate-200 shadow-sm">
                                <h3 className="text-xs font-black text-slate-400 mb-4 uppercase tracking-widest">Entry Pool</h3>
                                <div className="flex flex-wrap gap-2 max-h-48 overflow-y-auto custom-scrollbar pr-2">
                                    {selectedList.length === 0 ? (
                                        <p className="text-sm text-slate-300 font-bold py-4 text-center w-full">참여 가능한 인원이 없습니다.</p>
                                    ) : selectedList.sort((a,b)=>a.name.localeCompare(b.name)).map(p => (
                                        <div key={p.id} className="px-3 py-1.5 bg-slate-50 border border-slate-100 rounded-lg text-xs font-bold text-slate-600 flex items-center gap-1.5">
                                            {p.isGuest && <span className="text-[9px] font-black bg-blue-100 text-blue-600 px-1 rounded-sm flex-shrink-0">G</span>}
                                            {p.name}
                                            {p.gender === '여성' && <span className="text-[9px] font-black text-pink-500">W</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-white p-8 rounded-[40px] border border-slate-200 shadow-lg text-left">
                                <div className="grid grid-cols-1 sm:grid-cols-2 gap-8 mb-8">
                                    <div className="flex flex-col gap-2 text-left">
                                        <label className="text-[10px] font-black text-slate-400 ml-1 uppercase">Team Count</label>
                                        <select className="p-4 bg-slate-50 rounded-2xl font-black text-lg" value={teamingSettings.teamCount} onChange={e => setTeamingSettings({...teamingSettings, teamCount: parseInt(e.target.value)})}>
                                            {[2,3,4,5,6].map(v => <option key={v} value={v}>{v}개 팀 균등 편성</option>)}
                                        </select>
                                    </div>
                                    <div className="flex items-end text-left">
                                        <label className="w-full flex items-center justify-between p-4 bg-slate-50 rounded-2xl border-2 border-transparent hover:border-blue-100 transition-all cursor-pointer">
                                            <span className="text-xs font-black text-slate-600">커플 무조건 동반 배정</span>
                                            <input type="checkbox" checked={teamingSettings.keepCouples} onChange={e => setTeamingSettings({...teamingSettings, keepCouples: e.target.checked})} className="w-6 h-6 accent-blue-600 rounded" />
                                        </label>
                                    </div>
                                </div>
                                <button onClick={generateTeams} className="w-full py-5 bg-blue-600 text-white rounded-[24px] font-black text-lg shadow-xl shadow-blue-100 hover:bg-blue-700 transition-all">규칙 기반 랜덤 팀 편성</button>
                            </div>
                        </div>
                    )}

                    {activeTab === 'results' && (
                        <div className="animate-fade-in">
                            {teams.length === 0 ? (
                                <div className="py-20 text-center text-slate-300 font-black">표시할 결과가 없습니다.</div>
                            ) : (
                                <>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 text-left">
                                        {teams.map((team, idx) => (
                                            <div key={idx} ref={el => teamRefs.current[idx] = el} className="team-card bg-white rounded-[40px] shadow-xl overflow-hidden border border-slate-100">
                                                <div className={`p-5 text-center font-black text-white flex justify-between items-center px-8 ${idx === 0 ? 'bg-rose-500' : idx === 1 ? 'bg-blue-500' : idx === 2 ? 'bg-emerald-600' : 'bg-orange-500'}`}>
                                                    <span className="text-lg uppercase font-black tracking-tight">Team {idx + 1}</span>
                                                    <span className="text-[10px] font-bold opacity-80 uppercase">{team.members.length} Players</span>
                                                </div>
                                                <div className="p-6 space-y-2.5">
                                                    {team.members.map((m, mIdx) => (
                                                        <div key={mIdx} className="flex items-center justify-between p-3.5 bg-slate-50 rounded-2xl hover:bg-white transition-all shadow-sm">
                                                            <div className="flex items-center gap-4">
                                                                <span className={`w-7 h-7 flex items-center justify-center rounded-full text-[10px] font-black ${mIdx === 2 || mIdx === 5 ? 'bg-blue-600 text-white ring-2 ring-blue-100 shadow-sm' : 'bg-slate-200 text-slate-500'}`}>{mIdx + 1}</span>
                                                                <div className="flex flex-col text-left">
                                                                    <div className="flex items-center gap-1.5">
                                                                        {m.isGuest && <span className="text-[9px] font-black bg-blue-100 text-blue-600 px-1 rounded-sm flex-shrink-0">G</span>}
                                                                        <span className="font-black text-slate-800 text-lg leading-none">{m.name}</span>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div className="flex items-center gap-3">
                                                                {m.gender === '여성' && <span className="text-[10px] font-black px-1.5 py-0.5 bg-pink-100 text-pink-600 rounded">W</span>}
                                                                <div className="flex flex-col items-end text-slate-900">
                                                                    <span className="text-xs font-black text-slate-400">{m.level}단</span>
                                                                    {m.coupleId && <div className="text-pink-400 mt-0.5"><Icon.Heart /></div>}
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    <div className="mt-10 p-8 bg-white rounded-[40px] border border-slate-200 shadow-lg space-y-8 text-left">
                                        <div className="flex flex-col sm:flex-row gap-4 justify-center">
                                            <button onClick={generateTeams} className="flex-1 max-w-xs flex items-center justify-center gap-2 px-8 py-5 bg-slate-900 text-white rounded-3xl font-black text-sm shadow-lg hover:bg-slate-800 transition-all">
                                                <Icon.Refresh /> 기준 유지하고 다시 섞기
                                            </button>
                                            <button onClick={saveDraft} className="flex-1 max-w-xs flex items-center justify-center gap-2 px-8 py-5 bg-blue-600 text-white rounded-3xl font-black text-sm shadow-xl hover:bg-blue-700 transition-all">
                                                <Icon.Bookmark /> 현재 편성 임시저장
                                            </button>
                                        </div>
                                        <div className="border-t border-slate-100 pt-8 text-left">
                                            <p className="text-center text-[11px] font-black text-slate-400 uppercase tracking-widest mb-4">Export Options</p>
                                            <div className="flex flex-col sm:flex-row gap-4 justify-center">
                                                <button onClick={captureIndividualTeams} disabled={isCapturing} className="flex-1 max-w-xs flex items-center justify-center gap-2 px-8 py-4 bg-slate-100 text-slate-700 rounded-2xl font-black text-xs hover:bg-slate-200 transition-all disabled:opacity-50"><Icon.Camera /> 팀별 개별 저장</button>
                                                <button onClick={captureAllInOne} disabled={isCapturing} className="flex-1 max-w-xs flex items-center justify-center gap-2 px-8 py-4 bg-blue-50 text-blue-600 rounded-2xl font-black text-xs hover:bg-blue-100 transition-all disabled:opacity-50"><Icon.Download /> 한 장으로 저장 (3팀씩)</button>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                    )}

                    {activeTab === 'drafts' && (
                        <div className="animate-fade-in space-y-4 text-left">
                            {savedDrafts.length === 0 ? (
                                <div className="py-20 text-center text-slate-300 font-black">기록이 없습니다.</div>
                            ) : savedDrafts.map(draft => (
                                <div key={draft.id} className="bg-white p-6 rounded-[32px] border border-slate-200 shadow-sm flex items-center justify-between transition-all hover:border-blue-300">
                                    <div className="text-left">
                                        <p className="text-lg font-black text-slate-900">{draft.timeLabel} 편성</p>
                                        <div className="flex flex-col gap-1 mt-1 text-slate-900 text-left">
                                            <div className="flex gap-2 items-center leading-none">
                                                <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">{draft.meetingDate}</span>
                                                {draft.meetingTimeRange && (
                                                    <React.Fragment>
                                                        <div className="w-px h-2 bg-slate-200" />
                                                        <span className="text-[10px] font-bold text-green-600 uppercase tracking-widest">{draft.meetingTimeRange}</span>
                                                    </React.Fragment>
                                                )}
                                                <div className="w-px h-2 bg-slate-200" />
                                                <span className="text-[10px] font-bold text-blue-500 uppercase tracking-widest">{draft.teams.length}개 팀</span>
                                            </div>
                                            {draft.managerName && (
                                                <div className="flex items-center gap-1 mt-0.5 opacity-60">
                                                    <Icon.Shield size={10} />
                                                    <span className="text-[9px] text-slate-400 font-bold leading-none uppercase tracking-tighter">{draft.managerName}</span>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={() => loadDraft(draft)} className="px-5 py-2.5 bg-blue-50 text-blue-600 rounded-xl font-black text-xs hover:bg-blue-100 transition-all">불러오기</button>
                                        <button onClick={() => deleteDraft(draft.id)} className="p-2.5 text-slate-300 hover:text-red-500 transition-all"><Icon.Trash /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
